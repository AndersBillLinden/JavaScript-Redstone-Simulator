{"ts":1370055629326,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*\n * JavaScript Redstone Simulator\n * Copyright (C) 2012  Jonathan Lydall (Email: jonathan.lydall@gmail.com)\n * \n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n * \n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n * \n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA. \n * \n */\n\n(function(){\n\tvar namespace = com.mordritch.mcSim;\n\tvar loremIpsum = \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed lacinia mattis faucibus. Vivamus nisi lorem, varius vel aliquet non, venenatis eu magna. Nulla eget sapien diam, a posuere purus. Aenean suscipit ultrices odio, vitae aliquet est tempor quis. Donec tincidunt magna eget turpis ultrices cursus. Phasellus vel erat sed dolor luctus convallis eget a ante. Suspendisse diam magna, euismod sed tincidunt sed, dapibus ut neque. Nulla vulputate dictum leo eget lacinia. Aenean in urna augue, eu mollis diam. Donec aliquet feugiat elit, sit amet convallis mi luctus sit amet.\"; //http://www.lipsum.com/\n\tvar Gui_FullApp = function(mcSim) {\n\t\tthis.defaultSettings = window.defaultOptions;\n\t\tthis.userSettings = JSON.parse(JSON.stringify(this.defaultSettings));\n\t\tthis.userSettings_onLoadCallbacks = [];\n\t\tthis.schematicMetadata = {};\n\t\tthis.tickerDomIds = {};\n\t\t\n\t\tthis.init = function() {\n\t\t\tthis.L10n = this.localization = new namespace.localization(window['localizationStrings']); //needs to be done as the very first, pretty much everything needs to make use of localization\n\t\t\tthis.input = new namespace.guiFullInput(this); //needs to be called before any components which want to use bindings\n\t\t\tthis.options = new namespace.options(this); //needs to be called before any components which want to register options\n\t\n\t\t\tthis.loaderModal = new namespace.guiFullModal(this);\n\t\t\tthis.loaderModal.setDomClass(\"prompt\");\n\t\t\tthis.loaderModal.bind('hide', function() {\n\t\t\t\tt.loaderMessaging.cancel = true;\n\t\t\t});\n\t\n\t\t\t$('#header').append(\n\t\t\t\t'<span class=\"documentToolBarLeft\"></span>' +\n\t\t\t\t'<span class=\"documentToolBarRight\"></span>'\n\t\t\t);\n\n\t\t\tthis.tooltip = new namespace.tooltip(this);\n\n\t\t\tthis.initGuiOptions();\n\t\t\tthis.initTopRightButtons();\n\t\t\tthis.initTopLeftButtons();\n\t\t\t\n\t\t\tthis.userManager = new namespace.guiFull_userManager(this);\n\t\t\t \n\t\t\tthis.toolHandler = new namespace.toolHandler(this);\n\t\t\tthis.mcSim = new namespace.MinecraftSimulator(this);\n\t\n\t\t\tthis.ticker = new namespace.guiFull_ticker(this); //not the actual ticker, just the gui's way of talking to it, depends on ticker inside mcSim having already been created\n\t\t\t\n\t\t\tthis.initPlaceableBlockList(); //needs to be run before the toolbar\n\t\t\tthis.initBlockHelpers();\n\t\n\t\t\tthis.modelviews = new namespace.guiFull_multiViewHandler(this);\n\t\t\tthis.toolbars = new namespace.guiFullToolbar(this);\n\t\t\tthis.sidebar = new namespace.sidebar(this);\n\t\t\tthis.viewPorts = new namespace.viewPorts(this);\n\t\t\t\n\t\t\tthis.documentOpen = new namespace.documentOpen(this);\n\t\t\tthis.documentNew = new namespace.documentNew(this);\n\t\t\tthis.documentSave = new namespace.documentSave(this);\n\t\t\tthis.documentSaveLocally = new namespace.documentSaveLocally(this);\n\t\t\tthis.documentInfo = new namespace.documentInfo(this);\n\t\t\tthis.documentDownloadSavedVersion = new namespace.documentDownloadSavedVersion(this);\n\n\t\t\tthis.documentResize = new namespace.documentResize(this);\n\t\t\tthis.documentRotate = new namespace.documentRotate(this);\n\t\t\t\n\t\t\tthis.submitFeedback = new namespace.submitFeedback(this);\n\t\t\t\n\t\t\tthis.urlHistory = new namespace.urlHistory(this);\n\t\t\tthis.googleAnalytics = new namespace.googleAnalytics(this); \n\t\t\t\n\t\t\tvar t = this;\n\t\t\t$('.addDocumentToolbarButton0fileOpen').bind('mouseenter.moveto', function() {\n\t\t\t\tt.documentOpen.initOverButton(); //Makes a file upload element ontop of the button, run now after the DOM positioning has settled down\n\t\t\t\t$('.addDocumentToolbarButton0fileOpen').unbind('mouseenter.moveto');\n\t\t\t});\n\t\t\t\n\t\t\t\n\t\t\tthis.loaderMessaging = {cancel: false};\n\t\n\t\t\tvar schematicIdToOpen = window['schematicIdToOpen'];\n\t\t\tthis.schematicMetadata = window['schematicMetadata'];\n\t\n\t\t\tif (this.schematicMetadata.error) {\n\t\t\t\tvar xDefaultSize = this.userSettings.options.simulator.xDefaultSize;\n\t\t\t\tvar yDefaultSize = this.userSettings.options.simulator.yDefaultSize;\n\t\t\t\tvar zDefaultSize = this.userSettings.options.simulator.zDefaultSize;\n\t\n\t\t\t\tthis.mcSim.makeNew(xDefaultSize, yDefaultSize, zDefaultSize, this.userSettings.options.simulator.startTickingWorldOnLoad);\n\t\t\t}\n\t\t\t\n\t\t\tthis.sideBarSchematicDescriptionElement = this.sidebar.addSection('','');\n\t\t\tthis.setSchematicMetadata(this.schematicMetadata, isNew = true);\n\t\t}\n\t\t\n\t\tthis.initBlockHelpers = function() {\n\t\t\tthis.blockHelper_Sign = new  namespace.blockHelper_Sign(this);\n\t\t}\n\t\t\n\t\tthis.setSchematicMetadata = function(parameters, isNew) {\n\t\t\tisNew = (typeof isNew == \"undefined\") ? false : isNew;\n\t\t\t\n\t\t\tvar schematicMetadata;\n\t\t\t\n\t\t\tif (isNew) {\n\t\t\t\tthis.schematicMetadata = {\n\t\t\t\t\tcreated: this.L10n.getString(\"document.metadata.default.created\"),\n\t\t\t\t\tlastModified: this.L10n.getString(\"document.metadata.default.lastModified\"),\n\t\t\t\t\tfileName: this.L10n.getString(\"document.metadata.default.fileName\"),\n\t\t\t\t\tfileSize: this.L10n.getString(\"document.metadata.default.fileSize\"),\n\t\t\t\t\tdescription: this.L10n.getString(\"document.metadata.default.description\"),\n\t\t\t\t\ttitle: this.L10n.getString(\"document.metadata.default.title\"),\n\t\t\t\t\tschematicId: -1,\n\t\t\t\t\tuserDisplayName: this.L10n.getString(\"document.metadata.default.userDisplayName\"),\n\t\t\t\t\tuserId: \"\"\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tschematicMetadata = this.schematicMetadata;\n\t\t\t\n\t\t\tfor (var parameter in parameters)\n\t\t\t{\n\t\t\t\tif (parameters[parameter] != \"\")\n\t\t\t\t{\n\t\t\t\t\tschematicMetadata[parameter] = parameters[parameter];\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar downloadNowString = this.L10n.getString(\"application.downloadnow\");\n\t\t\t\n\t\t\t$('#headerDocumentTitle').text(\" - \" + escapeHtml(schematicMetadata.title));\n\t\t\tif (schematicMetadata.title != \"\") {\n\t\t\t\t$('#headerDocumentTitle').append(' (<a href=\"./download/?downloadId='+schematicMetadata.schematicId+'\">' + downloadNowString + '</a>)');\n\t\t\t}\n\n\t\t\tvar sideBarBodyText =\n\t\t\t\tthis.L10n.getString(\"sidebar.schematic.info.title\") +\n\t\t\t\t'<br/>' +\n\t\t\t\t'<b>' +\n\t\t\t\tescapeHtml(schematicMetadata.title) +\n\t\t\t\t'</b>' +\n\t\t\t\t'<br/>' +\n\t\t\t\t'<br/>' +\n\t\t\t\tthis.L10n.getString(\"sidebar.schematic.info.uploadedby\") +\n\t\t\t\t'<br/>' +\n\t\t\t\t'<b>' +\n\t\t\t\tescapeHtml(schematicMetadata.userDisplayName) +\n\t\t\t\t'</b>' +\n\t\t\t\t'<br/>' +\n\t\t\t\t'<br/>' +\n\t\t\t\tthis.L10n.getString(\"sidebar.schematic.info.description\") +\n\t\t\t\t' ' +\n\t\t\t\tescapeHtml(schematicMetadata.description).replace(\"\\\\n\", \"<br/>\");\n\n\t\t\tthis.sidebar.addSection(\n\t\t\t\tthis.L10n.getString(\"sidebar.schematic.info.header\"),\n\t\t\t\tsideBarBodyText,\n\t\t\t\thideByDefault = false,\n\t\t\t\tthis.sideBarSchematicDescriptionElement\n\t\t\t);\n\t\t\t\n\t\t\tthis.urlHistory.setSchematicId(schematicMetadata.schematicId, useReplaceState = false, noChange = true);\n\t\t}\n\t\t\n\t\tthis.initGuiOptions = function() {\n\t\t\tthis.options.registerOption({\n\t\t\t\ttype: 'number',\n\t\t\t\tname: 'xDefaultSize',\n\t\t\t\tcategory: 'simulator',\n\t\t\t\tdefaultValue: 32,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 2048\n\t\t\t});\n\t\n\t\t\tthis.options.registerOption({\n\t\t\t\ttype: 'number',\n\t\t\t\tname: 'yDefaultSize',\n\t\t\t\tcategory: 'simulator',\n\t\t\t\tdefaultValue: 8,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 256\n\t\t\t});\n\t\n\t\t\tthis.options.registerOption({\n\t\t\t\ttype: 'number',\n\t\t\t\tname: 'zDefaultSize',\n\t\t\t\tcategory: 'simulator',\n\t\t\t\tdefaultValue: 32,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 2048\n\t\t\t});\n\t\n\t\t\tthis.options.registerOption({\n\t\t\t\ttype: 'boolean',\n\t\t\t\tname: 'startTickingWorldOnLoad',\n\t\t\t\tcategory: 'simulator',\n\t\t\t\tdefaultValue: true\n\t\t\t});\n\t\t\t\n\t\t}\n\t\t\n\t\tthis.initTopRightButtons = function() {\n\t\t\tvar container = '.documentToolBarRight';\n\t\t\tvar t = this;\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'options',\n\t\t\t\t'options',\n\t\t\t\t'images/icons/configure-4.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.options.showOptionsScreen();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'input',\n\t\t\t\t'input',\n\t\t\t\t'images/icons/configure-shortcuts.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.input.modal.show();\n\t\t\t\t}\n\t\t\t);\n\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'toolbars',\n\t\t\t\t'toolbars',\n\t\t\t\t'images/icons/configure-toolbars.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.toolbars.modal.show();\n\t\t\t\t}\n\t\t\t);\n\t\n\t\t\t/*\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'help',\n\t\t\t\t'help',\n\t\t\t\t'images/icons/help-3.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\t//t.toolbars.modal.show();\n\t\t\t\t}\n\t\t\t);\n\t\t\t*/\n\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'sidebar',\n\t\t\t\t'sidebar',\n\t\t\t\t'images/icons/view-right-close.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.sidebar.toggle();\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\t\n\t\tthis.initTopLeftButtons = function() {\n\t\t\tvar container = '.documentToolBarLeft';\n\t\t\tvar t = this;\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'fileNew',\n\t\t\t\t'fileNew',\n\t\t\t\t'images/icons/document-new-5.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentNew.prompt();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'fileOpen',\n\t\t\t\t'fileOpen',\n\t\t\t\t'images/icons/document-open-5.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentOpen.show();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'fileSave',\n\t\t\t\t'fileSave',\n\t\t\t\t'images/icons/document-save-5.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentSave.save();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'fileSaveAs',\n\t\t\t\t'fileSaveAs',\n\t\t\t\t'images/icons/document-save-as-5.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentSave.saveAs();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarSeperator(container);\n\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'documentSaveLocally',\n\t\t\t\t'documentSaveLocally',\n\t\t\t\t'images/icons/download.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentSaveLocally.save();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'schematicDownload',\n\t\t\t\t'schematicDownload',\n\t\t\t\t'images/icons/download-3.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentDownloadSavedVersion.download();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarSeperator(container);\n\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'documentResize',\n\t\t\t\t'documentResize',\n\t\t\t\t'images/icons/transform-scale-2.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentResize.show();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'documentRotate',\n\t\t\t\t'documentRotate',\n\t\t\t\t'images/icons/object-rotate-right.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentRotate.show();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'documentInformation',\n\t\t\t\t'documentInformation',\n\t\t\t\t'images/icons/document-properties.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.documentInfo.show();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarSeperator(container);\n\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'editSelect',\n\t\t\t\t'editSelect',\n\t\t\t\t'images/icons/edit/edit-select.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\t//t.notYetImplemented();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'editCopy',\n\t\t\t\t'editCopy',\n\t\t\t\t'images/icons/edit/edit-copy-4.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\t//t.notYetImplemented();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'editPaste',\n\t\t\t\t'editPaste',\n\t\t\t\t'images/icons/edit/edit-paste-4.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\t//t.notYetImplemented();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'editDelete',\n\t\t\t\t'editDelete',\n\t\t\t\t'images/icons/edit/edit-delete-4.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\t//t.notYetImplemented();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarSeperator(container);\n\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'viewPortsSplitHorizontally',\n\t\t\t\t'viewPortsSplitHorizontally',\n\t\t\t\t'images/icons/view-split-left-right-2.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.viewPorts.ToggleSplitHorizontally();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'viewPortsSplitVertically',\n\t\t\t\t'viewPortsSplitVertically',\n\t\t\t\t'images/icons/view-split-top-bottom-2.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.viewPorts.ToggleSplitVertically();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarSeperator(container);\n\n\t\t\tvar tickerStop = this.addDocumentToolbarButton(\n\t\t\t\t'tickerStop',\n\t\t\t\t'tickerStop',\n\t\t\t\t'images/icons/media-playback-pause-7.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.ticker.stop();\n\t\t\t\t}\n\t\t\t);\n\t\n\t\t\tvar tickerRun = this.addDocumentToolbarButton(\n\t\t\t\t'tickerRun',\n\t\t\t\t'tickerRun',\n\t\t\t\t'images/icons/media-playback-start-7.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.ticker.start();\n\t\t\t\t}\n\t\t\t);\n\t\n\t\t\tvar tickerStep = this.addDocumentToolbarButton(\n\t\t\t\t'tickerStep',\n\t\t\t\t'tickerStep',\n\t\t\t\t'images/icons/media-playback-step-7.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.ticker.step();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tvar tickerTickFor = this.addDocumentToolbarButton(\n\t\t\t\t'tickerTickFor',\n\t\t\t\t'tickerTickFor',\n\t\t\t\t'images/icons/media-skip-forward-7.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.ticker.tickFor();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\tvar tickUntilStopTextBoxId = \"tickUntilStopTextBox\";\n\t\t\t$(container).append(\n\t\t\t\t'<input type=\"text\" id=\"'+ tickUntilStopTextBoxId +'\" value=\"\">'\n\t\t\t);\n\t\t\t\n\t\t\t$(\"#\" + tickUntilStopTextBoxId).bind(\"keyup\", function(e){\n\t\t\t\tif (e.which == 13) {\n\t\t\t\t\tt.ticker.tickFor();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addDocumentToolbarSeperator(container);\n\n\t\t\t$(container).append(\n\t\t\t\t'<span class=\"topToolbarText\">' + this.L10n.getString(\"ticker.tickcounter\") + '</span>'\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarButton(\n\t\t\t\t'resetTickCounter',\n\t\t\t\t'resetTickCounter',\n\t\t\t\t'images/icons/view-refresh-4.png',\n\t\t\t\tcontainer,\n\t\t\t\tfunction() {\n\t\t\t\t\tt.ticker.resetTickCounter();\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\t$(container).append(\n\t\t\t\t' <span class=\"topToolbarText\" id=\"tickCounter\">0</span>'\n\t\t\t);\n\t\t\t\n\t\t\tthis.addDocumentToolbarSeperator(container);\n\n\t\t\tthis.tickerDomIds.tickCounterId = \"tickCounter\";\n\t\t\tthis.tickerDomIds.stopButtonClass = tickerStop;\n\t\t\tthis.tickerDomIds.runButtonClass = tickerRun;\n\t\t\tthis.tickerDomIds.stepButtonClass = tickerStep;\n\t\t\tthis.tickerDomIds.tickForButtonClass = tickerTickFor;\n\t\t\tthis.tickerDomIds.tickForTextboxId = tickUntilStopTextBoxId;\n\t\t}\n\t\t\n\t\tthis.addDocumentToolbarButton = function(name, description, imageUrl, container, onClickCallback) {\n\t\t\tvar className = 'addDocumentToolbarButton_'+name;\n\t\t\tvar t = this;\n\t\t\t\n\t\t\t$(container).append(\n\t\t\t\t'<span class=\"'+className+' topToolbarUnselected\"><img src=\"'+imageUrl+'\" /></span> '\n\t\t\t);\n\t\t\t\n\t\t\tthis.input.bindInputEvent({\n\t\t\t\tsavedKeyName: name,\n\t\t\t\tcategory: 'toolbar.top',\n\t\t\t\tdescription: 'shortcuts.toolbar.top.'+name,\n\t\t\t\tcallbackFunction: onClickCallback\n\t\t\t});\n\n\t\t\tthis.tooltip.createForElement(\n\t\t\t\t$domElement = $('.addDocumentToolbarButton_'+name),\n\t\t\t\tposition = \"below\",\n\t\t\t\theaderText = 'toolbar.top.tooltips.'+description+'.title',\n\t\t\t\tbodyText = 'toolbar.top.tooltips.'+description+'.description',\n\t\t\t\tshortcutKeyScope = 'main',\n\t\t\t\tshortcutKeyEventName = name);\n\n\t\t\t$(container+' .'+className).bind('click', onClickCallback);\n\t\t\treturn className;\n\t\t}\n\t\t\n\t\t/**\n\t\t * Adds a toolbar seperator \n\t\t */\n\t\tthis.addDocumentToolbarSeperator = function(container) {\n\t\t\t$(container).append(\n\t\t\t\t'<span class=\"toolbarSeperator\"></span>'\n\t\t\t);\n\t\t}\n\t\t\n\t\t/**\n\t\t * Classes can register to be notified if usersettings are loaded\n\t\t */\n\t\tthis.userSettings_registerForOnLoadCallback = function(callback) {\n\t\t\tthis.userSettings_onLoadCallbacks.push(callback);\n\t\t}\n\t\t\n\t\t/**\n\t\t * Tells all clases which are registered for usersetting change notifcation through callbacks\n\t\t */\n\t\tthis.userSettingsLoaded = function(options) {\n\t\t\tfor (var i=0; i<this.userSettings_onLoadCallbacks.length; i++) {\n\t\t\t\tthis.userSettings_onLoadCallbacks[i]();\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.loadSchematicId = function(schematicId) {\n\t\t\tif (typeof schematicId == \"undefined\" || schematicId == null) throw new Error(\"loadSchematicId() Schematic ID cannot be undefined.\");\n\t\t\t\n\t\t\tthis.loaderModal.setContent(\"Downloading from server...\"); //TODO: Use a localized string\n\t\t\tthis.loaderModal.show();\n\n\t\t\tif (typeof this.schematicMetadata.schematicId != \"undefined\" && this.schematicMetadata.schematicId == schematicId) {\n\t\t\t\tthis.ajaxGetSchematicData (schematicId);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar t = this;\n\t\t\t\t$.ajax({\n\t\t\t\t\turl: 'php/getSchematicMetadata.php?id=' + schematicId,\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\tt.setSchematicMetadata(data, isNew = true);\n\t\t\t\t\t\tt.ajaxGetSchematicData(data.schematicId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.ajaxGetSchematicData = function(schematicIdToOpen) {\n\t\t\tvar t = this;\n\t\t\t\n\t\t\tvar url = 'php/openBinaryById.php?id=' + schematicIdToOpen;\n\t\n\t\t\t$.ajax({\n\t\t\t\turl: url,\n\t\t\t\tprogress: function(xhrObject) {\n\t\t\t\t\tconsole.log(\"ajaxGetSchematicData: \", xhrObject);\n\t\t\t\t},\n\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\n\t\t\t\t\tbase64_decode_async({\n\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\tsuccess: function(b64DecodedData) {\n\t\t\t\t\t\t\tt.loaderModal.setContent(\"Reading NBT data...\");\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tt.loadSchematic(b64DecodedData);\n\t\t\t\t\t\t\t},0);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprogress: function(task, amount) {\n\t\t\t\t\t\t\tvar percentDone = \"\" + Math.floor((amount/data.length)*100) + \"%\";\n\t\t\t\t\t\t\tt.loaderModal.setContent(\"Task: Base 64 decoding<br/>Progress: \"+percentDone);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\t\n\t\t/**\n\t\t * Takes input as a binary .schematic file contents   \n\t\t */\n\t\tthis.loadSchematic = function(data) {\n\t\t\tvar isError = false;\n\t\t\t\n\t\t\ttry {\n\t\t\t} \n\t\t\tcatch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tisError = true;\n\t\t\t}\n\t\t\t\n\t\t\tif (!isError) {\n\t\t\t\t/*\n\t\t\t\tWhen testing encoding / decoding, uncomment below, and comment above\n\t\t\t\t\n\t\t\t\tvar nbtData1 = new namespace.NbtParser().encode(nbtData, false, true);\n\t\t\t\tvar nbtData2 = new namespace.NbtParser().decode(nbtData1);\n\t\t\t\tt.mcSim.loadWorldData(nbtData2, t.userSettings.simulator.startTickingWorldOnLoad);\n\t\t\t\t*/\n\t\t\t\t\n\t\t\t\t//$('#schem').val(JSON.stringify(data)); //Uncomment to export a loaded schematic to a text blob\n\t\t\t}\n\t\t\t\t\n\t\t\tthis.loaderModal.setContent(\"Reading NBT data...\"); //TODO: Localize\n\t\t\tthis.loaderModal.show();\n\t\t\t\n\t\t\tvar t = this;\n\t\t\tthis.loaderMessaging.cancel = false;\n\t\t\tnew namespace.NbtParser().decode({\n\t\t\t\tdata: data,\n\t\t\t\tupdateInterval: 1000,\n\t\t\t\tprogress: function(category, progress, messaging) {\n\t\t\t\t\tif (t.loaderMessaging.cancel) {\n\t\t\t\t\t\tmessaging.cancel = true;\n\t\t\t\t\t}\n\t\t\t\t\t//console.log(\"progress: %s\", progress);\n\t\t\t\t\tt.loaderModal.setContent(\"Task: \"+category+\"<br/>Progress: \"+progress);\n\t\t\t\t\tt.documentOpen.createForm();\n\t\t\t\t\t//t.mcSim.loadProgress(category, progress);\n\t\t\t\t},\n\t\t\t\tcancel: function() {\n\t\t\t\t\t//console.log(\"cancelled.\");\n\t\t\t\t\t//t.loaderModal.setContent(\"Task: \"+category+\"<br/>Progress: \"+progress);\n\t\t\t\t},\n\t\t\t\tsuccess: function(nbtData) {\n\t\t\t\t\tvar startTickingWorldOnLoad = t.userSettings.options.simulator.startTickingWorldOnLoad;\n\t\t\t\t\tt.sidebar.show(noAnimate = true);\n\t\t\t\t\tt.ticker.resetTickCounter();\n\t\t\t\t\tt.mcSim.loadWorld(nbtData, startTickingWorldOnLoad);\n\t\t\t\t\tt.loaderModal.hide();\n\t\t\t\t\t//t.tempToParticularView();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\tthis.tempToParticularView = function() {\n\t\t\tvar \n\t\t\t\tNORTH = 0,\n\t\t\t\tEAST = 1,\n\t\t\t\tSOUTH = 2,\n\t\t\t\tWEST = 3;\n\t\t\t\n\t\t\tthis.viewPorts.ToggleSplitHorizontally();\n\t\t\tvar sideView = this.modelviews.getModelViewByCssClass('modelViewTopRight');\n\n\t\t\tsideView.changeFacingTo(WEST);\n\t\t\tsideView.layerTo(1);\n\t\t}\n\t\t\n\t\t\n\t\tthis.saveSchematic = function(options) {\n\t\t\tvar nbtData = this.mcSim.saveWorld();\n\t\t\tvar nbtParser = new namespace.NbtParser();\n\t\t\tnbtParser.encode({\n\t\t\t\tdata: nbtData,\n\t\t\t\tencloseInUnnamedCompoundTag: false,\n\t\t\t\tgzipDeflate: true,\n\t\t\t\tsuccess: function() {\n\t\t\t\t\tconsole.log(\"saveSchematic(): success callback.\");\n\t\t\t\t},\n\t\t\t\tprogress: function() {\n\t\t\t\t\tconsole.log(\"saveSchematic(): progress callback.\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\t/**\n\t\t * Queries all blocks to get a list of blocktypes the user can place\n\t\t */\n\t\tthis.initPlaceableBlockList = function() {\n\t\t\tvar blocksList = this.mcSim.Block.blocksList;\n\t\t\tvar placeableBlocks = {};\n\t\t\tvar zoomLevel = 5;\n\t\t\t\n\t\t\t$('body').append('<canvas id=\"tempForIconGeneration\" width=\"'+zoomLevel*8+'\" height=\"'+zoomLevel*8+'\" style=\"display:none\"></canvas>');\n\t\t\tvar canvasDomObject = document.getElementById(\"tempForIconGeneration\");\n\t\t\t//var context = new namespace.CanvasInterface();\n\t\t\tcontext = canvasDomObject.getContext(\"2d\");\n\t\t\t\n\t\t\t//context.getContext(canvasDomObject);\n\t\t\t\n\t\t\tfor (block in blocksList) {\n\t\t\t\tvar placeableBlockResults = blocksList[block].enumeratePlaceableBlocks();\n\t\t\t\tfor (placeableBlockType in placeableBlockResults) {\n\t\t\t\t\tvar blockType = placeableBlockResults[placeableBlockType];\n\t\t\t\t\t\n\t\t\t\t\t//Fenerate an icon:\n\t\t\t\t\tcontext.setTransform(1, 0, 0, 1, 0, 0); //resets the translate coords\n\t\t\t\t\tcontext.scale(zoomLevel, zoomLevel);\n\t\t\t\t\tcontext.clearRect(0,0,8,8);\n\t\t\t\t\tblocksList[block].drawIcon(this.mcSim.Block, context, blockType.blockMetadata);\n\t\t\t\t\tblockType.iconImageData = canvasDomObject.toDataURL();\n\t\n\t\t\t\t\tplaceableBlocks[blockType.blockType+'_'+blockType.blockID+'_'+blockType.blockMetadata] = (blockType);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.placeableBlocks = placeableBlocks;\n\t\t\t//console.log(placeableBlocks);\n\t\t\t$('canvas#tempForIconGeneration').remove();\n\t\t}\n\t\t\n\t\t/**\n\t\t * Pauses all keybinding events\n\t\t * \n\t\t * For example, a modal calls this as it is shown, so that it overrides key events for itself\n\t\t */\n\t\tthis.pauseBindings = function() {\n\t\t\tthis.input.suspend();\n\t\t}\n\t\t\n\t\t/**\n\t\t * Resumes all keybinding events\n\t\t * \n\t\t * For example, a modal calls this as it hides itself to make key and mouse events work again \n\t\t */\n\t\tthis.resumeBindings = function() {\n\t\t\tthis.input.resume();\n\t\t}\n\t\t\n\t\t/**\n\t\t * Get an option's  current value\n\t\t */\n\t\tthis.getOption = function(category, name) {\n\t\t\treturn this.options.getOption(category, name);\n\t\t}\n\t\t\n\t\tthis.refreshModelViews = function() {\n\t\t\tthis.modelviews.drawAllBlocks();\n\t\t}\n\t\t\n\t\tthis.init();\n\t}\n\t\n\tnamespace['Gui_FullApp'] = Gui_FullApp;\n}());\n"]],"start1":0,"start2":0,"length1":0,"length2":22125}]],"length":22125}
