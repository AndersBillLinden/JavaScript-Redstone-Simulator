{"ts":1370056342014,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*\n * JavaScript Redstone Simulator\n * Copyright (C) 2012  Jonathan Lydall (Email: jonathan.lydall@gmail.com)\n * \n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n * \n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n * \n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA. \n * \n */\n\ncom.mordritch.mcSim.World_Level = function(level) {\n\tthis.level = level;\n\t\n\tthis.chunkSizeX = 16;\n\tthis.chunkSizeY = 128;\n\tthis.chunkSizeZ = 16;\n\t\n\t/**\n\t * Makes this instantiation generate and use a new schematic filled with air\n\t */\n\t/*\n\tthis.makeNew = function(sizeX, sizeY, sizeZ) {\n\t\tvar schematicSizeX = 16;\n\t\tvar schematicSizeY = 128;\n\t\tvar schematicSizeZ = 16;\n\n\t\tvar byteArrayContents = \"\";\n\t\t\n\t\tfor (var i = 0; i < sizeX*sizeY*sizeZ; i++) {\n\t\t\tbyteArrayContents += String.fromCharCode(0);\n\t\t}\n\t\t \n\t\tthis.schematic = {\n\t\t\tLevel: {\n\t\t\t\ttype: 10,\n\t\t\t\tpayload: {\n\t\t\t\t\tHeight: {\n\t\t\t\t\t\ttype: 2, \n\t\t\t\t\t\tpayload: 128\n\t\t\t\t\t},\n\t\t\t\t\tLength: {\n\t\t\t\t\t\ttype: 2,\n\t\t\t\t\t\tpayload: 16\n\t\t\t\t\t},\n\t\t\t\t\tWidth: {\n\t\t\t\t\t\ttype: 2,\n\t\t\t\t\t\tpayload: 16\n\t\t\t\t\t},\n\t\t\t\t\tEntities: {\n\t\t\t\t\t\ttype: 9,\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\ttype: 10,\n\t\t\t\t\t\t\tpayload: new Array()\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tTileEntities: {\n\t\t\t\t\t\ttype: 9,\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\ttype: 10,\n\t\t\t\t\t\t\tpayload: new Array()\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tMaterials: {\n\t\t\t\t\t\ttype: 8,\n\t\t\t\t\t\tpayload: \"Alpha\"\n\t\t\t\t\t},\n\t\t\t\t\tBlocks: {\n\t\t\t\t\t\ttype: 7,\n\t\t\t\t\t\tpayload: byteArrayContents\n\t\t\t\t\t},\n\t\t\t\t\tData: {\n\t\t\t\t\t\ttype: 7,\n\t\t\t\t\t\tpayload: byteArrayContents\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\t*/\n\n\t/**\n\t * Returns the position:\n\t */\n\tthis.getPosition = function(x, y, z) {\n\t\t/*\n\t\tThe Minecraft coordinate system is as follows:\n\t\t(http://www.minecraftwiki.net/wiki/Alpha_Level_Format/Chunk_File_Format#Block_Format)\n\n\t\tX \t\t\tincreases East, decreases West\n\t\tY \t\t\tincreases upwards, decreases downwards\n\t\tZ\t\t\tincreases South, decreases North\n\t\t\n\t\tunsigned char BlockID = Blocks[ y + z * ChunkSizeY(=128) + x * ChunkSizeY(=128) * ChunkSizeZ(=16) ];\n\t\t*/\n\t\t\n\t\tif (x >= this.chunkSizeX || x < 0)\n\t\t\tthrow new Error(\"WorldTypeLevel.getPosition(): x is out of bounds.\")\n\t\t\n\t\tif (y >= this.chunkSizeY || y < 0)\n\t\t\tthrow new Error(\"WorldTypeLevel.getPosition(): y is out of bounds.\")\n\t\t\n\t\tif (z >= this.chunkSizeZ || z < 0)\n\t\t\tthrow new Error(\"WorldTypeLevel.getPosition(): z is out of bounds.\")\n\t\t\n\t\treturn y + z * this.chunkSizeY + x * this.chunkSizeY * this.chunkSizeZ;\n\t}\n\t\n\t/**\n\t * Returns the blockID at specified minecraft world co-ordinates\n\t */\n\tthis.getBlockId = function(x, y, z) {\n\t\t//If a function calls for a blocktype which is off the grid, return 0 (air)\n\t\tif (\n\t\t\tx >= this.getSizeX() || x < 0\n\t\t\t|| y >= this.getSizeY()\t|| y < 0\n\t\t\t|| z >= this.getSizeZ()\t|| z < 0\n\t\t) {\n\t\t\treturn 0;\n\t\t}\n\t\telse {\n\t\t\treturn this.level.Level.payload.Blocks.payload.charCodeAt(this.getPosition(x,y,z)) & 0xff;\n\t\t}\n\t}\n\t\n\t/**\n\t * Returns the meta data for block at specified minecraft world co-ordinates\n\t */\n\tthis.getBlockMetadata = function(x, y, z) {\n\t\tvar position = Math.floor(this.getPosition(x,y,z)/2);\n\t\tvar fullByte = this.level.Level.payload.Data.payload.charCodeAt(position) & 0xff;\n\n\t\tif (this.getPosition(x,y,z)%2 == 0) {\n\t\t\treturn fullByte & 0x3;\n\t\t}\n\t\telse {\n\t\t\treturn fullByte >>> 4;\n\t\t}\n\t}\n\t\n\t/**\n\t * Returns the x size of the schematic in terms minecraft co-ordinate system\n\t */\n\tthis.getSizeX = function() {\n\t\treturn this.chunkSizeX;\n\t}\n\t\n\t/**\n\t * Returns the y size of the schematic in terms minecraft co-ordinate system\n\t */\n\tthis.getSizeY = function() {\n\t\treturn this.chunkSizeY;\n\t}\n\t\n\t/**\n\t * Returns the z size of the schematic in terms minecraft co-ordinate system\n\t */\n\tthis.getSizeZ = function() {\n\t\treturn this.chunkSizeX;\n\t}\n\t\n\t/**\n\t * Retrieve a Tile Entity\n\t */\n\tthis.getTileEntity = function(x, y, z) {\n\t\t//TODO: Implement\n\t}\n\t\n\t/**\n\t * Retrieve an entity\n\t */\n\tthis.getEntity = function(x, y, z) {\n\t\t\n\t}\n\t\n\t/**\n\t * Removes internal reference to the schematic object allowing it to be freed by the garbage collector.\n\t * \n\t * We can't force freeing of memory in Javascript, but as long as there is no referrence to the object\n\t * then the garbage collector should eventually free it up. \n\t */\n\tthis.destroy = function() {\n\t\tthis.level = undefined;\n\t}\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":4709}]],"length":4709}
{"contributors":[],"silentsave":true,"ts":1370056349558,"patch":[[{"diffs":[[0,"n(level)"],[-1," "],[0,"{\n\tthis."]],"start1":886,"start2":886,"length1":17,"length2":16}]],"length":4708,"saved":false}
{"ts":1370056378300,"patch":[[{"diffs":[[0,"\n\t\t\n\t\tif"],[-1," "],[0,"(x >= th"]],"start1":2485,"start2":2485,"length1":17,"length2":16}]],"length":4707,"saved":false}
{"ts":1370056379307,"patch":[[{"diffs":[[0,"\n\t\t\n\t\tif"],[-1," "],[0,"(y >= th"]],"start1":2596,"start2":2596,"length1":17,"length2":16}]],"length":4706,"saved":false}
{"ts":1370056431288,"patch":[[{"diffs":[[0," bounds.\")\n\t"],[-1,"\t"],[0,"\n\t\tif(y >= t"]],"start1":2586,"start2":2586,"length1":25,"length2":24}]],"length":4705,"saved":false}
{"ts":1370056432783,"patch":[[{"diffs":[[0,"nds.\")\n\t"],[-1,"\t"],[0,"\n\t\tif (z"]],"start1":2700,"start2":2700,"length1":17,"length2":16}]],"length":4704,"saved":false}
{"ts":1370056433764,"patch":[[{"diffs":[[0,"nds.\")\n\t"],[-1,"\t"],[0,"\n\t\tretur"]],"start1":2811,"start2":2811,"length1":17,"length2":16}]],"length":4703,"saved":false}
{"ts":1370056444387,"patch":[[{"diffs":[[0,")\n\t\n\t\tif"],[-1," "],[0,"(z >= th"]],"start1":2705,"start2":2705,"length1":17,"length2":16}]],"length":4702,"saved":false}
{"ts":1370056447483,"patch":[[{"diffs":[[0,"unds.\")\n"],[-1,"\t"],[0,"\n\t\tretur"]],"start1":2809,"start2":2809,"length1":17,"length2":16}]],"length":4701,"saved":false}
{"ts":1370056493917,"patch":[[{"diffs":[[0,"ion(x, y, z)"],[-1," "],[0,"{\n\t\t//If a f"]],"start1":2997,"start2":2997,"length1":25,"length2":24}]],"length":4700,"saved":false}
{"ts":1370056511994,"patch":[[{"diffs":[[0,"ir)\n\t\tif"],[-1," "],[0,"(\n\t\t\tx >"]],"start1":3085,"start2":3085,"length1":17,"length2":16}]],"length":4699,"saved":false}
{"ts":1370056513890,"patch":[[{"diffs":[[0," < 0\n\t\t)"],[-1," {"],[0,"\n\t\t\tretu"]],"start1":3195,"start2":3195,"length1":18,"length2":16}]],"length":4697,"saved":false}
{"ts":1370056516502,"patch":[[{"diffs":[[0,"turn 0;\n"],[-1,"\t\t}\n"],[0,"\t\telse {"]],"start1":3209,"start2":3209,"length1":20,"length2":16}]],"length":4693,"saved":false}
{"ts":1370056528389,"patch":[[{"diffs":[[0,"X() || x < 0"],[1," ||"],[0,"\n\t\t\t|| y >= "]],"start1":3115,"start2":3115,"length1":24,"length2":27},{"diffs":[[0,"|| y < 0"],[1," "],[0,"\n\t\t\t|| z"]],"start1":3158,"start2":3158,"length1":16,"length2":17}]],"length":4697,"saved":false}
{"ts":1370056529859,"patch":[[{"diffs":[[0,"| y < 0 "],[1,"||"],[0,"\n\t\t\t|| z"]],"start1":3159,"start2":3159,"length1":16,"length2":18}]],"length":4699,"saved":false}
{"ts":1370056531957,"patch":[[{"diffs":[[0,"0 ||\n\t\t\t"],[-1,"|| "],[0,"y >= thi"]],"start1":3126,"start2":3126,"length1":19,"length2":16}]],"length":4696,"saved":false}
{"ts":1370056533475,"patch":[[{"diffs":[[0,"0 ||\n\t\t\t"],[-1,"|| "],[0,"z >= thi"]],"start1":3162,"start2":3162,"length1":19,"length2":16}]],"length":4693,"saved":false}
{"ts":1370056535940,"patch":[[{"diffs":[[0,"etSizeY("],[-1,")\t"],[0,"|| y < 0"]],"start1":3145,"start2":3145,"length1":18,"length2":16}]],"length":4691,"saved":false}
{"ts":1370056537412,"patch":[[{"diffs":[[0,"etSizeY("],[1,") "],[0,"|| y < 0"]],"start1":3145,"start2":3145,"length1":16,"length2":18}]],"length":4693,"saved":false}
{"ts":1370056540658,"patch":[[{"diffs":[[0,"tSizeZ()"],[-1,"\t"],[1," "],[0,"|| z < 0"]],"start1":3182,"start2":3182,"length1":17,"length2":17}]],"length":4693,"saved":false}
{"ts":1370056549840,"patch":[[{"diffs":[[0,"rn 0;\n\t\telse"],[-1," {"],[0,"\n\t\t\treturn t"]],"start1":3211,"start2":3211,"length1":26,"length2":24}]],"length":4691,"saved":false}
{"ts":1370056551647,"patch":[[{"diffs":[[0,"& 0xff;\n"],[-1,"\t\t}\n"],[0,"\t}\n\t\n\t/*"]],"start1":3310,"start2":3310,"length1":20,"length2":16}]],"length":4687,"saved":false}
{"ts":1370056582205,"patch":[[{"diffs":[[0,"ion(x, y, z)"],[-1," "],[0,"{\n\t\tvar posi"]],"start1":3441,"start2":3441,"length1":25,"length2":24}]],"length":4686,"saved":false}
{"ts":1370056586977,"patch":[[{"diffs":[[0,"n(x,y,z)"],[-1,"/"],[1," / "],[0,"2);\n\t\tva"]],"start1":3498,"start2":3498,"length1":17,"length2":19}]],"length":4688,"saved":false}
{"ts":1370056596648,"patch":[[{"diffs":[[0,"f;\n\n\t\tif"],[-1," "],[0,"(this.ge"]],"start1":3594,"start2":3594,"length1":17,"length2":16},{"diffs":[[0,"%2 == 0)"],[-1," "],[0,"{\n\t\t\tret"]],"start1":3626,"start2":3626,"length1":17,"length2":16}]],"length":4686,"saved":false}
{"ts":1370056599521,"patch":[[{"diffs":[[0,"y,z)"],[-1,"%"],[1," % "],[0,"2 =="]],"start1":3622,"start2":3622,"length1":9,"length2":11}]],"length":4688,"saved":false}
{"ts":1370056600896,"patch":[[{"diffs":[[0,") % 2 =="],[1,"="],[0," 0){\n\t\t\t"]],"start1":3625,"start2":3625,"length1":16,"length2":17}]],"length":4689,"saved":false}
{"ts":1370056603615,"patch":[[{"diffs":[[0," & 0x3;\n"],[-1,"\t\t}\n"],[0,"\t\telse {"]],"start1":3657,"start2":3657,"length1":20,"length2":16}]],"length":4685,"saved":false}
{"ts":1370056604939,"patch":[[{"diffs":[[0,"2 === 0)"],[-1,"{"],[0,"\n\t\t\tretu"]],"start1":3629,"start2":3629,"length1":17,"length2":16}]],"length":4684,"saved":false}
{"ts":1370056606089,"patch":[[{"diffs":[[0,";\n\t\telse"],[-1," {"],[0,"\n\t\t\tretu"]],"start1":3662,"start2":3662,"length1":18,"length2":16},{"diffs":[[0,">> 4;\n\t\t"],[-1,"}"],[0,"\n\t}\n\t\n\t/"]],"start1":3691,"start2":3691,"length1":17,"length2":16}]],"length":4681,"saved":false}
{"ts":1370056607202,"patch":[[{"diffs":[[0," >>> 4;\n"],[-1,"\t\t\n"],[0,"\t}\n\t\n\t/*"]],"start1":3689,"start2":3689,"length1":19,"length2":16}]],"length":4678,"saved":false}
{"ts":1370056627064,"patch":[[{"diffs":[[0,"zeX = function()"],[-1," "],[0,"{\n\t\treturn this."]],"start1":3801,"start2":3801,"length1":33,"length2":32}]],"length":4677,"saved":false}
{"ts":1370056637315,"patch":[[{"diffs":[[0,"zeY = function()"],[-1," "],[0,"{\n\t\treturn this."]],"start1":3949,"start2":3949,"length1":33,"length2":32}]],"length":4676,"saved":false}
{"ts":1370056639150,"patch":[[{"diffs":[[0,"= function()"],[-1," "],[0,"{\n\t\treturn t"]],"start1":4101,"start2":4101,"length1":25,"length2":24}]],"length":4675,"saved":false}
{"ts":1370056668087,"patch":[[{"diffs":[[0,"n this.chunkSize"],[-1,"X"],[1,"Z"],[0,";\n\t}\n\t\n\t/**\n\t * "]],"start1":4122,"start2":4122,"length1":33,"length2":33}]],"length":4675,"saved":false}
{"ts":1370056683202,"patch":[[{"diffs":[[0,"ion(x, y, z)"],[-1," "],[0,"{\n\t\t//TODO: "]],"start1":4210,"start2":4210,"length1":25,"length2":24}]],"length":4674,"saved":false}
{"ts":1370056684342,"patch":[[{"diffs":[[0,"ion(x, y, z)"],[-1," "],[0,"{\n\t\t\n\t}\n\t\n\t/"]],"start1":4305,"start2":4305,"length1":25,"length2":24}]],"length":4673,"saved":false}
{"ts":1370056725145,"patch":[[{"diffs":[[0,"nction()"],[-1," "],[0,"{\n\t\tthis"]],"start1":4631,"start2":4631,"length1":17,"length2":16}]],"length":4672,"saved":false}
